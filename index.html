<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>QwertyStars</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ */
    /* –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–≤–ª—é —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è */
    
    /* Case Animation - Fixed */
    .case-wheel-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }
    .case-wheel-container {
      width: 90%;
      max-width: 400px;
      background: var(--card);
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      position: relative;
      border: 3px solid var(--gold);
      box-shadow: 0 0 40px rgba(251, 191, 36, 0.5);
    }
    .wheel-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--gold);
    }
    .wheel-prizes {
      display: flex;
      overflow: hidden;
      height: 140px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      margin: 20px 0;
      position: relative;
      border: 2px solid var(--accent);
    }
    .wheel-prize-strip {
      display: flex;
      transition: transform 3s cubic-bezier(0.2, 0.8, 0.2, 1);
      position: absolute;
      left: 0;
      top: 0;
    }
    .wheel-prize-item {
      width: 100px;
      height: 100px;
      flex-shrink: 0;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      margin: 20px 10px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      border: 2px solid var(--gold);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .wheel-center-line {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--gold);
      transform: translateX(-50%);
      z-index: 10;
      box-shadow: 0 0 20px var(--gold);
    }
    .wheel-center-line::before {
      content: '‚ñº';
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--gold);
      font-size: 24px;
      text-shadow: 0 0 10px var(--gold);
    }
    .wheel-result {
      font-size: 24px;
      font-weight: 800;
      margin: 20px 0;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gold);
      text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
    }
    
    /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
  </style>
</head>
<body>

  <!-- Cases Section (Main) -->
  <div id="cases" class="section active">
    <div class="container">
      <div class="header">
        <div></div>
        <div style="font-weight: 700; font-size: 20px;">üéÅ –ö–µ–π—Å—ã</div>
        <button class="close-btn" onclick="closeApp()">‚úï</button>
      </div>

      <!-- Top Balance Bar -->
      <div class="top-balance">
        <div class="balance-item">
          <span>‚≠ê</span>
          <span id="stars" class="formatted-number">15 000</span>
          <div class="plus" onclick="addStars()">+</div>
        </div>
        <div class="balance-item">
          <span>üéüÔ∏è</span>
          <span id="tickets" class="formatted-number">25</span>
          <div class="plus" onclick="addTickets()">+</div>
        </div>
      </div>

      <div class="live">
        <span>LIVE</span>
        <div class="live-item">üéÑ</div>
        <div class="live-item">üéÇ</div>
        <div class="live-item">üê∏</div>
        <div class="live-item">‚ùÑÔ∏è</div>
      </div>

      <div class="cases-grid">
        <div class="case-item" onclick="openCase(1)">
          <div class="case-icon">üéÅ</div>
          <div class="case-name">–û–±—ã—á–Ω—ã–π –∫–µ–π—Å</div>
          <div class="case-price">100 ‚≠ê</div>
        </div>
        <div class="case-item premium" onclick="openCase(2)">
          <div class="case-icon">üíé</div>
          <div class="case-name">–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å</div>
          <div class="case-price">500 ‚≠ê</div>
        </div>
        <div class="case-item fire" onclick="openCase(3)">
          <div class="case-icon">üî•</div>
          <div class="case-name">–û–≥–Ω–µ–Ω–Ω—ã–π –∫–µ–π—Å</div>
          <div class="case-price">1 000 ‚≠ê</div>
        </div>
        <div class="case-item royal" onclick="openCase(4)">
          <div class="case-icon">üëë</div>
          <div class="case-name">–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –∫–µ–π—Å</div>
          <div class="case-price">5 000 ‚≠ê</div>
        </div>
        <div class="case-item all-or-nothing" onclick="openCase(5)">
          <div class="case-icon">‚ö°</div>
          <div class="case-name">–í–°–ï –ò–õ–ò –ù–ò–ß–ï–ì–û</div>
          <div class="case-price">2 000 ‚≠ê</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Case Wheel Animation Modal -->
  <div class="case-wheel-modal" id="caseWheelModal">
    <div class="case-wheel-container">
      <div class="header">
        <div></div>
        <div style="font-weight: 700; font-size: 18px;">QwertyStars</div>
        <button class="close-btn" onclick="closeCaseWheel()">‚úï</button>
      </div>
      
      <div class="wheel-title">–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞</div>
      
      <div class="roulette-balance">
        <span id="wheelBalance" class="formatted-number">15 000</span> ‚≠ê
      </div>
      
      <div class="wheel-prizes">
        <div class="wheel-center-line"></div>
        <div class="wheel-prize-strip" id="wheelPrizeStrip">
          <!-- Prize items will be added dynamically -->
        </div>
      </div>
      
      <div class="wheel-result" id="wheelResult"></div>
      
      <button class="action-btn green" onclick="closeCaseWheel()" id="wheelCloseBtn" style="display: none; margin: 0 auto;">
        –ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑!
      </button>
    </div>
  </div>

  <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ (Slots, Roulette, Profile, Invite) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->

  <script>
    // Initialize Telegram Web App
    let tg;
    try {
      tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();
    } catch (e) {
      console.log('Telegram Web App not available');
      tg = {
        HapticFeedback: {
          impactOccurred: () => {},
          notificationOccurred: () => {}
        },
        close: () => { alert('App would close here'); }
      };
    }

    // Game state
    let stars = 15000;
    let tickets = 25;
    let invitedCount = 2;
    let earnedAmount = 45;

    // Format numbers with spaces
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }

    // Update UI
    function updateUI() {
      const elements = {
        'stars': stars,
        'tickets': tickets,
        'slotsStars': stars,
        'slotsTickets': tickets,
        'rouletteStars': stars,
        'rouletteTickets': tickets,
        'rouletteBalance': stars,
        'profileBalance': stars,
        'wheelBalance': stars,
        'invitedCount': invitedCount,
        'earnedAmount': earnedAmount
      };

      for (const [id, value] of Object.entries(elements)) {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = formatNumber(value);
        }
      }
    }

    // Navigation
    function openSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      const navIndex = {'cases':0, 'slots':1, 'roulette':2, 'profile':3}[id];
      if (navIndex !== undefined) {
        document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
      }
      
      try {
        tg.HapticFeedback.impactOccurred('light');
      } catch (e) {}
    }

    // Modals
    function openModal(id) {
      document.getElementById(id).style.display = 'flex';
      try {
        tg.HapticFeedback.impactOccurred('soft');
      } catch (e) {}
    }

    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    function closeApp() {
      try {
        tg.close();
      } catch (e) {
        alert('App would close here');
      }
    }

    // Cases - FIXED ANIMATION
    function openCase(caseType) {
      const casePrices = {1: 100, 2: 500, 3: 1000, 4: 5000, 5: 2000};
      const price = casePrices[caseType];
      
      if (stars < price) {
        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê!');
        return;
      }

      stars -= price;
      updateUI();

      const rewards = {
        1: [50, 100, 150, 200, 300, 400, 500],
        2: [250, 500, 750, 1000, 1500, 2000, 2500],
        3: [500, 1000, 2000, 3000, 5000, 7500, 10000],
        4: [2500, 5000, 7500, 10000, 15000, 20000, 25000],
        5: [0, 0, 0, 0, 0, 0, 10000] // –í—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ
      };
      
      const reward = rewards[caseType][Math.floor(Math.random() * rewards[caseType].length)];
      showCaseWheelAnimation(caseType, reward);
    }

    function showCaseWheelAnimation(caseType, reward) {
      const modal = document.getElementById('caseWheelModal');
      const strip = document.getElementById('wheelPrizeStrip');
      const resultText = document.getElementById('wheelResult');
      const closeBtn = document.getElementById('wheelCloseBtn');
      
      // Clear and fill prize strip
      strip.innerHTML = '';
      const rewards = {
        1: [50, 100, 150, 200, 300, 400, 500],
        2: [250, 500, 750, 1000, 1500, 2000, 2500],
        3: [500, 1000, 2000, 3000, 5000, 7500, 10000],
        4: [2500, 5000, 7500, 10000, 15000, 20000, 25000],
        5: [0, 0, 0, 0, 0, 0, 10000]
      };
      
      const caseRewards = rewards[caseType];
      
      // Create multiple copies for smooth animation - FIXED COUNT
      const copiesCount = 10; // Increased for more smooth animation
      for (let i = 0; i < copiesCount; i++) {
        caseRewards.forEach(prize => {
          const prizeElement = document.createElement('div');
          prizeElement.className = 'wheel-prize-item';
          if (prize === 0) {
            prizeElement.innerHTML = `<div style="font-size: 24px;">üíÄ</div><div>0</div>`;
            prizeElement.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
          } else {
            prizeElement.innerHTML = `<div style="font-size: 24px;">‚≠ê</div><div>${formatNumber(prize)}</div>`;
          }
          strip.appendChild(prizeElement);
        });
      }
      
      // Show modal
      modal.style.display = 'flex';
      resultText.textContent = '–ö—Ä—É—Ç–∏–º –∫–æ–ª–µ—Å–æ...';
      closeBtn.style.display = 'none';
      
      // Reset animation
      strip.style.transition = 'none';
      strip.style.transform = 'translateX(0)';
      
      // Force reflow
      void strip.offsetWidth;
      
      // Start animation - FIXED CALCULATION
      setTimeout(() => {
        // Find the exact position of the reward in the strip
        const prizeIndex = caseRewards.indexOf(reward);
        const totalPrizes = copiesCount * caseRewards.length;
        
        // Calculate target position to center the winning prize
        // We want the selected prize to be in the middle of the visible area
        const prizeWidth = 120; // width + margin
        const visibleWidth = 400; // approximate visible area width
        const centerPosition = visibleWidth / 2;
        
        // Find position of the reward in the middle copy
        const middleCopyIndex = Math.floor(copiesCount / 2);
        const targetPrizeIndex = middleCopyIndex * caseRewards.length + prizeIndex;
        const targetPosition = -(targetPrizeIndex * prizeWidth - centerPosition + prizeWidth / 2);
        
        // Apply animation
        strip.style.transition = 'transform 3s cubic-bezier(0.2, 0.8, 0.2, 1)';
        strip.style.transform = `translateX(${targetPosition}px)`;
        
        // Show result after animation
        setTimeout(() => {
          if (reward === 0) {
            resultText.innerHTML = 'üò¢ –í—ã –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–∏–≥—Ä–∞–ª–∏!';
            resultText.style.color = '#ef4444';
          } else {
            resultText.innerHTML = `üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${formatNumber(reward)} ‚≠ê!`;
            resultText.style.color = '#fbbf24';
            stars += reward;
            updateUI();
          }
          
          closeBtn.style.display = 'flex';
          try {
            tg.HapticFeedback.notificationOccurred(reward === 0 ? 'error' : 'success');
          } catch (e) {}
        }, 3200); // Slightly longer than animation
      }, 100);
    }

    function closeCaseWheel() {
      document.getElementById('caseWheelModal').style.display = 'none';
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–ª–æ—Ç—ã, —Ä—É–ª–µ—Ç–∫–∞ –∏ —Ç.–¥.) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

    // Initialize
    updateUI();
    
    // Add click handlers for bet buttons
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.bet-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });
    });
  </script>
</body>
</html>
